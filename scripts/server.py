import pandas as pd
from flask import Flask

from pyamber.flask_amberdata import amberdata
from pyamber.request import TimeInterval

if __name__ == '__main__':
    app = Flask(__name__)
    app.config.from_pyfile('/amberdata/config/settings.cfg')
    amberdata.init_app(app)

    with app.app_context():
        #assert amberdata.request.health
        #x = amberdata.request.price_history("eth_usd", timeInterval=TimeInterval.DAYS, startDate=pd.Timestamp("2020-01-12"), endDate=pd.Timestamp("2020-01-15"))
        #print(x)
        for exchange, data in amberdata.request.ohlcv_latest("eth_usd", exchange="bitfinex,bitstamp,gdax,gemini,kraken,okex"):
            print(exchange)
            print(data)

        for exchange, data in amberdata.request.exchanges(pair="eth_usd"):
            print(exchange)
            print(len(data))
        #for ex, data in amberdata.request.bid_ask_history("eth_usd", exchange="bitfinex,bitstamp", startDate=pd.Timestamp("2020-01-12"), endDate=pd.Timestamp("2020-01-16")):
        #    print(ex)
        #    print(data)

    #{'payload': {'metadata': {'columns': ['timestamp', 'open', 'high', 'low', 'close', 'volume']}, 'data': {'bitfinex': [[1578787200000, 142.41, 143.54, 141.54, 143.21, 1777.55292345], [1578790800000, 143.21, 143.9260927, 142.87, 143.05, 939.83363797], [1578794400000, 143.01, 144.18, 142.97, 143.99, 396.5948699], [1578798000000, 143.97, 144.19, 143.5, 143.62, 235.24705306], [1578801600000, 143.92, 144.00393266, 143.3, 143.44, 385.76120784], [1578805200000, 143.44, 143.81489275, 143.44, 143.80377275, 83.0313331], [1578808800000, 143.81489275, 145.45, 143.81489275, 144.18, 3310.54030255], [1578812400000, 144.27, 144.64, 144.14, 144.48, 225.71154031], [1578816000000, 144.36, 145, 144.28193253, 144.49, 1297.32350639], [1578819600000, 144.57, 144.65, 144.04, 144.18, 546.0767149], [1578823200000, 144.13, 144.25, 142.92, 143.52, 666.02383002], [1578826800000, 143.39, 143.54, 143.15, 143.15, 188.64983985], [1578830400000, 143.15, 143.96, 143.15, 143.52, 952.00257628], [1578834000000, 143.63, 144.8, 143.20329303, 144.76, 1588.89174017], [1578837600000, 144.8, 144.95, 143.45905229, 143.77, 1844.62635556], [1578841200000, 143.9, 144.79, 143.84, 144.59, 204.51209539], [1578844800000, 144.42, 145.13, 143.48, 143.73, 825.95350822], [1578848400000, 143.79, 145.2, 143.43, 143.93721269, 1537.23840556], [1578852000000, 144.18, 144.45, 144.17, 144.45, 73.32282502], [1578855600000, 144.45, 144.59832086, 144.09289262, 144.09289262, 284.07366908], [1578859200000, 144.09, 144.68, 144.09, 144.56, 572.34049345], [1578862800000, 144.5671656, 144.65, 144.3, 144.37, 606.72458875], [1578866400000, 144.39, 145.35, 144.39, 145.26, 742.18395871], [1578870000000, 145.31, 146.35, 144.85, 146.34, 3190.55238217]], 'bitstamp': [[1578787200000, 142.37, 143.3, 141.83, 143.3, 121.65137081], [1578790800000, 143.73, 143.73, 142.97, 142.97, 23.65881738], [1578794400000, 143.05, 144.32, 143.05, 144.01, 16.15147231], [1578798000000, 143.93, 144.07, 143.63, 143.88, 17.80257014], [1578801600000, 143.86, 144, 143.76, 143.76, 8.856546], [1578805200000, 143.7, 144.16, 143.55, 144.01, 28.48233695], [1578808800000, 144.06, 145.74, 144.06, 144.22, 150.80550869], [1578812400000, 144.25, 144.87, 144.25, 144.58, 136.51750442], [1578816000000, 144.37, 145.18, 144.37, 144.87, 204.05516516], [1578819600000, 144.41, 144.72, 144.27, 144.31, 12.24311028], [1578823200000, 144, 144, 143.17, 143.81, 251.2984284], [1578826800000, 143.58, 143.64, 143.16, 143.23, 124.77307367], [1578830400000, 143.43, 144.2, 143.17, 143.52, 957.70326078], [1578834000000, 143.83, 144.97, 143.34, 144.97, 293.73579065], [1578837600000, 145.19, 145.23, 143.73, 143.92, 298.03872356], [1578841200000, 144.21, 144.91, 144, 144.89, 308.89851767], [1578844800000, 144.71, 145, 143.85, 143.85, 18.660972], [1578848400000, 143.77, 145.34, 143.53, 144.02, 132.30849787], [1578852000000, 144.53, 144.74, 144.31, 144.74, 15.11542361], [1578855600000, 144.51, 144.84, 144.23, 144.29, 159.88146662], [1578859200000, 144.29, 144.79, 144.29, 144.75, 80.77355729], [1578862800000, 144.63, 144.86, 144.45, 144.53, 180.33419833], [1578866400000, 144.36, 145.53, 144.31, 145.21, 314.87953115], [1578870000000, 145.56, 146.55, 144.83, 146.28, 462.79494291]]}}}